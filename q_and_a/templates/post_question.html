{% extends "main_frame.html" %}
{% block title %}
質問を投稿する | {{ block.super }}
{% endblock title %}


{% block content %}
<script>
$(document).ready(function(){
    markdown2html();
    document.getElementById('id_body').onkeyup=markdown2html;
});

//遷移防止
window.onbeforeunload = function(event){
    event = event || window.event; 
    event.returnValue = 'ページから移動しますか？';
  }
</script>
<section id="mde-buttons" class="section">
    {% csrf_token %}
    <form method="POST">
        {% csrf_token%}
    <div class="field">
        <label>
            {{ form.title.label_tag}}
        </label>
        <div class="control is-large">
            {{ form.title }}
        </div>
    </div>

    <div class="field has-addons">
        <p class="control">
            <button class="button" onclick="bold_button()">
                <i class="fa fa-bold"></i>
            </button>
        </p>
        <p class="control">
            <button class="button" onclick="italic_button()">
                <i class="fa fa-italic"></i>
            </button>
        </p>
        <p class="control">
            <button class="button" onclick="header_button()">
                <i class="fas fa-heading"></i>
            </button>
        </p>
        <p class="control">
            <button class="button">
                <i class="fa fa-list-ul"></i>
            </button>
        </p>
        <p class="control">
            <button class="button">
                <i class="fa fa-list-ol"></i>
            </button>
        </p>
        <p class="control">
            <button class="button">
                <i class="fa fa-quote-right"></i>
            </button>
        </p>
        <p class="control">
            <button class="button">
                <i class="fa fa-link"></i>
            </button>
        </p>
        <p class="control">
            <button class="button">
                <i class="fa fa-image"></i>
            </button>
        </p>
        <p class="control">
            <button class="button" data-target="cheat-sheet" onclick="question_button()">
                <i class="fa fa-question-circle"></i>
            </button>
        </p>
    </div>
    <!-- **************************************-->
    <!-- **************************************-->

    <div class="content" id="editor">
        {{ form.body }}
        <!--<textarea id="input" onkeyup="markdown2html()"># hoge</textarea>-->
        <div id="result_6efc3b09-3fc2-0a7a-8ca0-3c3c04b331fc"></div>

        <!-- markdownチートシートの表示 -->
        <article id="cheat-sheet" class="message is-hidden">
            <div class="message-header">
                <p>Markdown cheat sheet</p>
                <button class="delete is-medium" aria-label="delete" onclick="hiddenCheatSheet()"></button>
            </div>
            <div class="message-body">
                <h4>Codes</h4>
                <pre>`var example = "hello!";`<br><br><em>Or spanning multiple lines...</em><br><br>```<br>var example = "hello!";<br>alert(example);<br>```</pre>
                <h4>Emphasis</h4>
                <pre>**<strong>bold</strong>**<br>*<em>italic</em>*<br>~~<strike>strikethrough</strike>~~</pre>
                <h4>Headers</h4>
                <pre># Big header<br>## Medium header<br>### Small header<br>#### Tiny header</pre>
                <h4>Image</h4>
                <pre>![](http://www.example.com/image.jpg)</pre>
                <h4>Lists</h4>
                <pre>* Generic list item<br>* Generic list item<br>* Generic list item<br><br>1. Numbered list item<br>1. Numbered list item<br>2. Numbered list item<br>3. Numbered list item</pre>
                <h4>Link</h4>
                <pre>[Text to display](http://www.example.com)</pre>
                <h4>Quotes</h4>
                <pre>> This is a quote.<br>> It can span multiple lines!</pre>
                <h4>Tables</h4>
                <pre>| Column 1 | Column 2 | Column 3 |
| -------- | -------- | -------- |<br>| John     | Doe      | Male     |<br>| Mary     | Smith    | Female   |<br><br><em>Or without aligning the columns...</em><br><br>| Column 1 | Column 2 | Column 3 |<br>| -------- | -------- | -------- |<br>| John | Doe | Male |<br>| Mary | Smith | Female |</pre>
            </div>
        </article>
    </div>

    <script>
        /*
        function getCookie(name) {
             var cookieValue = null;
             if (document.cookie && document.cookie != '') {
                 var cookies = document.cookie.split(';');
                 for (var i = 0; i < cookies.length; i++) {
                     var cookie = jQuery.trim(cookies[i]);
                     // Does this cookie string begin with the name we want?
                     if (cookie.substring(0, name.length + 1) == (name + '=')) {
                         cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                         break;
                     }
                 }
             }
             return cookieValue;
        }
        */
        function save_draft(){
            $.ajax({
                    url: "ajax/save_draft",
                    headers: {"X-CSRFToken" : getCookie("csrftoken")},
                    method: "POST",
                    data: {
                        id : $("input[name='dftid']")[0].value,
                        title: $("#id_title")[0].value,
                        body: $("#id_body")[0].value,
                    },
                    timeout: 10000,
                    contentType: "application/json",
            })
            .done(function(data) {
                data = new String(data);
                $("input[name='dftid']")[0].value = data;
            });
        }
        
        function toggleDraftMenu(){
            $("#id_draft_table").toggleClass("is-active");
            
            if($("#id_draft_table").hasClass("is-active")){//表示した場合
                $.ajax({
                    url: "ajax/get_drafts",
                    headers: {"X-CSRFToken" : getCookie("csrftoken")},
                    method: "POST",
                    timeout: 10000,
                    contentType: "application/json",
                })
                .done(function(data){//data->table
                    var html = ""
                    var jsondata = JSON.parse(data);
                    for(var i=0; i<jsondata.length; ++i){
                        var content = jsondata[i];
                        

                    }
                });
            }
        }

    </script>
    
    <input type="hidden" name="dftid" value="initial">
        
    <div class="footer_toolbar_container has-background-link-dark level">
        <div class="level-left">
            <button class="button is-rounded is-link level-item" type="button">ファイルから記入</button>
            <button class="button is-rounded is-link level-item" type="button" onclick="toggleDraftMenu()">下書きから記入</button>
        </div>
        <div class="footer_toolbar level-right">
            <button class="button is-large is-primary footer_toolbar_button" type="submit">投稿する</button>
            <button class="button is-large is-info is-light footer_toolbar_button" type="button" onclick="save_draft()" formaction="ajax/save_draft">下書き保存</button>
      </div>
    </div>
    </form>

</section>

<!-- draft list -->
<div id="id_draft_table" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">下書きを選んでください</p>
        <button class="delete" aria-label="close" onclick='toggleDraftMenu()'></button>
      </header>
      <section class="modal-card-body">
        <div class="has-text-centered">
            <i class="fad fa-spinner-third fa-spin fa-5x"></i>
        </div>
        <div><!--table-->
            <table class="table">
                <thead>
                    <tr>
                        <th><abbr title="Created">作成日時</abbr></th>
                        <th><abbr title="Modified">最終更新</abbr></th>
                        <th><abbr title="Title">タイトル</abbr></th>
                        <th><abbr title="Body">本文</abbr></th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th><abbr title="Created">作成日時</abbr></th>
                        <th><abbr title="Modified">最終更新</abbr></th>
                        <th><abbr title="Title">タイトル</abbr></th>
                        <th><abbr title="Body">本文</abbr></th>
                    </tr>
                </tfoot>
                <tbody>
                  <tr>
                  </tr>
                </tbody>
            </table>
        </div>
      </section>
      <footer class="modal-card-foot">
        <button class="button is-success">選択</button>
        <button class="button" onclick="toggleDraftMenu()">キャンセル</button>
      </footer>
    </div>
  </div>
{% endblock %}

{%block footermenu %}

{% endblock %}